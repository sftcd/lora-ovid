<?xml version="1.0"?>
<!DOCTYPE rfc SYSTEM "rfc2629.dtd" [

<!ENTITY I-D.vilajosana-lpwan-lora-hc SYSTEM "http://xml.resource.org/public/rfc/bibxml3/reference.I-D.vilajosana-lpwan-lora-hc">
]>

<?rfc toc="yes"?>
<?rfc comments="yes"?>
<?rfc inline="yes" ?>
<rfc category="info" ipr="trust200902" docName="draft-farrell-lpwan-lora-overview-00">
<front>
   <title abbrev="lora overview">
     LoRaWAN Overview 
   </title>


<author fullname="Stephen Farrell" initials="S." surname="Farrell">
<organization>Trinity College Dublin</organization>
<address>
<postal>
<street></street>
<city>Dublin</city>
<region></region>
<code>2</code>
<country>Ireland</country>
</postal>
<phone>+353-1-896-2354</phone>
<email>stephen.farrell@cs.tcd.ie</email>
</address>
</author>


   <author initials="A" surname="Yegin" fullname="Alper Yegin">
      <organization>Actility</organization>
      <address>
         <postal>
            <street></street>
            <city>Paris</city>
            <region>Paris</region>
            <code></code>
            <country>FR</country>
         </postal>
         <email>alper.yegin@actility.com</email>
      </address>
   </author>
   
   <date/>
   <area>Internet Area</area>
   <workgroup>lpwan</workgroup>
   <keyword>Draft</keyword>
   <abstract>

	  <t>Low Power Wide Area Networks (LPWAN) are wireless technologies
covering different Internet of Things (IoT) applications.  The common
characteristics for LPWANs are large coverage, low bandwidth, small packet and
application layer data sizes and long battery life operation.  One of these
technologies is LoRaWAN developed by the LoRa Alliance.  LoRaWAN targets key
requirements of the Internet of things such as secure bi-directional
communication, mobility and localization services.  This memo is an
informational overview of LoRaWAN and gives the principal characteristics and
restrictions of this technology in order to help with the IETF work for
providing IPv6 connectivity over LoRaWAN along with other LPWANs.

      </t>
   </abstract>
</front>

<middle>
   <section title="Introduction">

	<t>[[Comments to be addressed before publication are in double square
brackets like this one]]</t>

	<t>[[As on 20161005 SF got to ~page32 of LoRaSpec, I'm working down
that and extracting bits of interest to the various sections here.]]</t>

	  <t> LoRaWAN is a wireless technology for long-range low-power
low-data-rate applications developed by the LoRa Alliance, a pay-for-membership
consortium.  <eref target="https://www.lora-alliance.org/"/> LoRaWAN networks
are typically organized in a star-of-stars topology in which gateways relay
messages between end-devices and a central "network server" in the backend.
Gateways are connected to the network server via IP links while end-devices use
single-hop LoRaWAN communication that can be received at one or more gateways.
All communication is generally bi-directional, although uplink communication
from end-devices to the network server are favoured in terms of overall
bandwidth availability.  </t>

	<t>In LoRaWAN networks, end-device transmissions may be received at
multiple gateways, so during nominal operation a network server may see
multiple instances of the same uplink message from an end-device.</t>

	  <t> Communication between end-devices and gateways uses
different frequencies and so-called spreading factors. 
[[Needs better explanation.]]
Selecting a
spreading factor is a trade-off between required link budget and data rate.
Spreading factors create virtual and orthogonal non-interfering communication
channels that enable simultaneous transmissions.  Depending on the used
spreading factor, LoRaWAN data rates range from 0.3 kbps to 50 kbps. </t>

<t>To
maximize both battery life of end-devices and overall network capacity, the
LoRaWAN network infrastructure manages the data rate and RF output for each
end-device individually by means of an adaptive data rate (ADR) scheme.
[[This seems to contradict the previous sentence.]]
End-devices may transmit on any channel available at any time, using any
available data rate.  </t>

<t>This memo provides an overview of the LoRaWAN technology for
the Internet community, but
the definitive specification 
      <xref target="LoRaSpec"/>
is that produced by the LoRa Alliance. [[What is the right version
on which to base this? I'm using 1.0.1 from Feb 2016 for now. Is
that public?]]</t>

   </section>

	<section title="Terminology">

	  <t> [[Not sure if 2119 terms will be needed. Leave it here for now.]] The key
words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT", "SHOULD", "SHOULD
NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this document are to be
interpreted as described in <xref target="RFC2119">RFC 2119</xref>.  </t> 
	

	<t>This section introduces some LoRaWAN terms.</t>
<t><list style="symbols">

	<t>End-device: a LoRa client device, sometimes called a mote. Communicates with gateways.</t>

	<t>Gateway: a radio on the infrastructure-side, sometimes called a concentrator or base-station.
	Communicates with gateways and, via the Internet, with a network server. [[one only?]]</t>

	<t>Network Server: [[does stuff]]</t>

	<t>Classes A, B and C are classes of end-device. All LoRaWAN devices have
bi-directional radios. The minimal end-device is class A and all devices need
to support acting as a class A device. Class B have additional end-device
receive slots allocated for better gateway to end-device bandwidth. Class C
end-devices can receive at any time they are not sending and hence have even
better inbound (to end-device) bandwidth. Classes B and C are not further 
discussed in this memo. [[Are these really classes of device
or modes of operation?]]</t>

	<t>Uplink message: refers to communications from end-device to network server via one or
more gateways. </t>

	<t>Downlink message: refers to communications from network server via one gateway to a single
end-device. </t>

</list></t>

	</section>

	<section anchor="spectrum" title="Spectrum">

	<t>LoRaWAN radios make use of ISM bands, for example 433MHz and 868MHz
within the European Union and 915Mhz in the Americas.</t>

	<t>As with other LPWAN radion technologies, LoRaWAN end-devices respect the
maximum transmit duty cycle relative to the sub-band used and local
regulations. In many cases, this means an end-device only transmitting for 0.1%
[[check]] of the time. The precise details of the duty-cycle is region
specific.</t>

	<t>The end-device changes channel in a pseudo-random fashion for every
transmission to help make the system more robust to interference.</t>

	<t>[[Add some table(s) summarising the important bits from chapter 7,
e.g. with min/max data rates, payload sizes, frequencies etc. Not sure
how best to do that but min/max might be ok.]]</t>

	</section>

   <section title="PHY">

      <t>
       Figure 1 below shows that after a transmission slot a Class A device
turns on its receiver for two short receive windows that are offset from
the end of the transmission window. The frequencies and data rate chosen
for these receive windows depend on those used for the transmit window.
If a downlink message preamble is detected during a receive window, then
the end-device keeps the radio on in order to reeive the frame.
</t>

<t>End-devices can only transmit a 2nd uplink frame after the end
of the associated receive windows.
</t>


<figure>
		<preamble>
		Figure 1: LoRaWAN Class A transmission and reception window.
       </preamble>
<artwork>
|----------------------------|         |--------|     |--------|
|             Tx             |         |   Rx   |     |   Rx   |
|----------------------------|         |--------|     |--------| 
                             |---------|         
                              Rx delay 1
                             |------------------------|
                              Rx delay 2             
</artwork>
</figure>
	</section>

	<section anchor="mac" title="MAC Layer">

	<t>Uplink and downlink higher layer data is carried in a MACPayload.  There
is a concept of "ports" (an optional 8 bit value) to handle different
applications on an end-device. The header also distinguishes different
directions and whether or not an acknowledgement ("confirmation") is required
from the peer.</t>

<t>In addition to carrying higher layer PDUs
there are Join-Request and Join-Response (aka Join-Accept) messages for handling 
network access. And so-called "MAC commands" up to 15 bytes long (e.g. for [[what]]) can be 
piggybacked in an options field ("FOpts").</t>

	<t>Payload lengths are variable with a maximum that is region-specific.</t>

	<t>All payloads are encrypted  
and ciphertexts are protected with a cryptographic
Message Integrity Check (MIC) 
- see <xref target="sec-cons"/> for details.</t>


	<t>LoRaWAN end-devices can choose various different data rates from a menu
of available rates (dependent on the frequencies in use). It is however, 
recommended that end-devices set the Adaptive Data Rate ("ADR") bit
in the MAC layer which is a signal that the network should control the
data rate (via MAC commands to the end-device). 
The network can also assert the ADR bit and control data rates at it's
discretion.
The goal is to ensure
minimal on-time for radios whilst increasing throughput when possible.
Other things being equal, the effect should be that end-devices closer to a 
gateway can successfully use higher data rates, whereas end-devices
further from all gateways still receive connectivity though at a lower
data rate.
</t>

	<t>Data rate changes can be validated via a scheme of acks from
the network with a fall-back to lower rates in the event that 
downlink acks go missing.</t>

	<t>There are 16 (or 32) bit frame counters maintained in each direction
that are incremented on each transmission (but not re-transmissions)
that are not re-used. When the device supports a 32 bit counter, then
only the least significant 16 bits are sent in the MAC header, but
all 32 bits are used in cryptographic operations. (If an end-device
only supports a 16 bit counter internally, then the topmost 16 bits
are set to zero.)</t>

	<t>There are a number of MAC commands for:
	Link and device status checking, ADR and duty-cycle negotiation,
managing the RX windows and radio channel settings. For example,
the link check response message allows the network server (in
response to a request from an end-device) to
inform an end-device about the signal attenuation seen most
recently at a gateway, and to also tell the end-device how
many gateways received the corresponding link request MAC
command.</t>

<t>Some MAC commands are initiated by the network server.
For example, one command allows the network server
to ask an end-device to reduce it's duty-cycle to only
use a proportion of the maximum allowed in a region. 
Another, allows the network server to query the
device as to it's power status with the response from
the end-device specifying whether it has an external power 
source or is battery powered (in which case a relative
level is also sent to the network server).</t>
	
	<t>The network server can also inform an end-device
about channel assignments (mid-point frequencies and data
rates). Of course, these must also remain within the
bands assigned for the region.</t>



	</section>

    <section title="Names and Addressing" anchor= "sec_lora_addressing">

	<t>A LoRaWAN network has a short network identifer ("NwkID") which is a 
seven bit value.  A private network (common for LoRaWAN) can use the value 
zero. If
a network wishes to support "foreign" end-devices then the NwkID
needs to be registered with the LoRA alliance, in which case the
NwkID is the seven least significant bits of a registered 24-bit
NetID. (Note however, that
the methods for "roaming" are currently being enhanced
within the LoRA Alliance, so the situation here is somewhat fluid.)</t>

	<t>In order to operate nominally on a LoRaWAN network, a device needs a 
32-bit device address, which is the catentation of the NwkID and a
25-bit device-specific network address that is assigned when the
device "joins" the network (see below for the join procedure) or
that is pre-provisioned into the device.</t>

	<t>End-devices are assumed to work with one or a quite limited 
number of applications, which matches most LoRaWAN use-cases. The
applications are identified by a 64-bit AppEUI, which is assumed
to be a registered IEEE EUI64 value.</t>

	<t>In addition, a device needs to have two symmetric session
keys, one for protecting network artefacts (port=0), the NwkSkey,
and another for protecting appliction layer traffic, the 
AppSKey. Both keys are used for 128 bit AES cryptgraphic
operations. (See <xref target="sec-cons"/> for details.)</t>

	<t>So, one option is for an end-device to have all of the above,
plus channel information, 
somehow (pre-)provisioned, in which case the end-device can
simply start transmitting. This is achievable in many cases via
out-of-band means given the nature of LoRaWAN networks.</t>

	<t>[[Add table of what's needed for nominal operation]]</t>

	<t>As an alternative, end-devices can use the LoRaWAN
Join procedure in order to setup some
of these values and dynamically gain access to the network.</t>

	<t>To use the Join interaction, an end-device must still
know the same AppEUI, plus some other items and the remaining pieces 
of information above are then derived from the Join procedure.</t>
	
	<t>In addition to the AppEUI, end-devices using the Join procedure
need to also know a different (long-term) symmetric key  that
is bound to the AppEUI - this is the application key (AppKey),
and is distinct from the application session key (AppSKey). The
AppKey is required to be specific to the device, that is, 
each end-device should have a different AppKey value. And
finally the end-device also needs a long-term identifier for
itself, syntactically also an EUI-64, and known as the 
device EUI or DevEUI.</t> 

	<t>The Join procedure involves a special exchange where
the end-device asserts the AppEUI and DevEUI (integrity 
protected with the long-term AppKey, but not encrypted) in a join-request
uplink message. This 
is then routed to the network server which interacts with
an entity that knows that AppKey to verify the join-request.
All going well, a join-accept downlink message is returned
to the end-device that specifies the 24-bit NetID, 32-bit
DevAddr
and channel information and from which the AppSKey and
NwkSKey can be derived.</t>

	<t>There is some special handling related to which channels 
to use and for multiple transmissions for the join-request which
is intended to ensure a successful join in as many cases as
possible. Join-request and join-accept messages also incldue
some random values (nonces) to both provide some replay 
protection and to help ensure the session keys are unique
per Join. If a join-request is not validated, then no join-accept
message (indeed no message at all) is returned to the end-device.
If an end-device is reset then it should end up in a
state in which it can re-do the Join procedure. </t>

	<t>[[Add a table with the Join procedure inputs and
results]]</t>


</section>

	<section title="Planned Changes">
	
	<t>As with many LPWAN technologies LoRaWAN is constantly evolving both
in details and in the large. For example, some detailed changes to the
cryptography used are being discussed within the LoRa Alliance. Whether or
not those result in backawards incompatible changes (things that affect
ciphertext usually do), will be apparent in the the latest LoRaWAN
specification.</t>

	<t>Various LoRaWAN message formats including the MAC layer have 
bits allocated that would allow for future changes to formats. In
such cases, gateways and network-servers will be expected to support
earlier releases, whereas end-devices may only support one version.</t>

	<t>There is also some scope for vendor-specific ("proprietary") 
extensions to MAC layer messages.</t>

	<t>Larger changes are being considered in terms of connecting together
multiple networks and allowing end-devices to roam over different networks.
These changes are expected to become stable in 2017. [[Just a guess, maybe
we don't want to say stuff like that, but no harm to let folks know roughly
what's likely to change in the lifetime of the LPWAN WG.]]</t>

	</section>

   <section anchor="sec-cons" title="Security Considerations">

	<t>In this section we describe the use of cryptography and other
security considerations arising. This section is not intended as a
full specification for LoRaWAN security but to be sufficient so
that future IETF specifications can encompass the required
security considerations.</t>

	<section anchor="key-mgmt" title="Activation/Personalisation and Key Management">

	<t>Keying for MAC layer payloads is specific to the port ("FPort").</t>

	<t>[[explain nw and app keys]]</t>

	<t>[[explain join special case]]</t>

	<t>[[explain when re-keying happens/is-needed]]</t>

	</section>


	<section anchor="crypto" title="Payload Encryption and Data Integrity">

	<t>All payloads are encrypted and have data integrity. Frame options
(used for MAC commands) when sent as a payload (FPort==0) are therefore 
protected. MAC commands piggy-backed as frame options ("FOpts") are
sent in clear.</t>

	<t>All MAC layer messages have an outer 32-bit Message Integrity Code (MIC) calculated
using AES-CMAC calculated over the ciphertext payload and other headers.</t>

	<t>Payloads are encrypted using 
AES-128, with a counter-mode dervived from IEEE 802.15.4. [[add ref]] </t>

	</section>

	<section anchor="other-sec-cons" title="Other Security and Privacy Considerations">

	<t>[[LoRaWAN has no built-in s/w update. That's a risk. And one it'd
be good to try fix in general. I can imageine that might be a wrench for
some folks.]]</t>

	<t>[[Describe privacy issues.]]</t>

	</section>
 	  
   </section>

   <section title="IANA Considerations">
      <t>
        There are no IANA considerations related to this memo.
      </t>
   </section>
   <section title="Acknowledgements">
      <t>
         The authors re-used some text from <xref target="I-D.vilajosana-lpwan-lora-hc"/>
      </t>

	<t>Thanks to [[your name here]] for comments.</t>

		<t>Stephen Farrell's work on this memo was supported by the
Science Foundation Ireleand funded CONNECT centre 
<eref target="https://connectcentre.ie/"/>.</t>
	
   </section>
	
	<section title="Implementation Status">

	<t>This section records the status of known implementations of the
     protocol defined by this specification at the time of posting of
     this Internet-Draft, and is based on a proposal described in
     <xref target="RFC7942">RFC 7942</xref>.  The description of implementations in this section is
     intended to assist the IETF in its decision processes in
     progressing drafts to RFCs.  Please note that the listing of any
     individual implementation here does not imply endorsement by the
     IETF.  Furthermore, no effort has been spent to verify the
     information presented here that was supplied by IETF contributors.
     This is not intended as, and must not be construed to be, a
     catalog of available implementations or their features.  Readers
     are advised to note that other implementations may exist.</t>

     <t>According to RFC 7942, "this will allow reviewers and working
     groups to assign due consideration to documents that have the
     benefit of running code, which may serve as evidence of valuable
     experimentation and feedback that have made the implemented
     protocols more mature.  It is up to the individual working groups
     to use this information as they see fit".</t>

	<t>There are a range of commercial and open-source implementations of LoRAWAN nodes and components.</t>

	<t>[[Doubtless more and some more details TBD if we keep this section]]</t>

	<t>RFC 7942 calls for this information for each implementation if that's useful to 
	provide:</t>


<t><list style="symbols">
  <t>The organization responsible for the implementation, if any.</t>
  <t>The implementation’s name and/or a link to a web page where the implementation
or a description of it can be found.</t>
  <t>A brief general description.</t>
  <t>The implementation’s level of maturity: research, prototype,
alpha, beta, production, widely used, etc.</t>
  <t>Coverage: which parts of the protocol specification are
implemented.</t>
  <t>Version compatibility: what version/versions of the Internet Draft
are known to be implemented.</t>
  <t>Licensing: the terms under which the implementation can be used.
For example: proprietary, royalty licensing, freely distributable
with acknowledgement (BSD style), freely distributable with
requirement to redistribute source (General Public License (GPL)
style), and other (specify).</t>
  <t>Implementation experience: any useful information the implementers
want to share with the community.</t>
  <t>Contact information: ideally a person’s name and email address,
but possibly just a URL or mailing list.</t>
  <t>The date when information about this particular implementation was
last updated.</t>
</list></t>

	
	<section title="LoRAMac-node">

	<t>There is a BSD Licensed implementation of the LoRaWAN MAC layer at <eref
target="https://github.com/Lora-net/LoRaMac-node"/>.</t>
	
	</section>

	</section>

</middle>

<back>
   <references title="Informative References">
      <?rfc include='reference.RFC.2119'?>
      <?rfc include='reference.RFC.7942'?>
      &I-D.vilajosana-lpwan-lora-hc;

      <reference anchor="LoRaSpec" target="https://www.lora-alliance.org/portals/0/specs/LoRaWAN%20Specification%201R0.pdf">
         <front>
            <title>
               LoRaWAN Specification Version V1.0.1
            </title>
            <author>
               <organization>LoRa Alliance</organization>
            </author>
            <date month="Feb" year="2016"/>
         </front>
      </reference>
	</references>
</back>
</rfc>
